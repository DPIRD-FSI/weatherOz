
---
title: "weatherOz for DPIRD"
author: "Rodrigo Pires, Anna Hepworth, Rebecca O'Leary and Adam H. Sparks"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{weatherOz for DPIRD}
  %\VignetteEngine{knitr::rmarkdown_notangle}
  %\VignetteEncoding{UTF-8}
---



# Working With DPIRD Data

Three functions are provided to streamline fetching data from the DPIRD Weather 2.0 API endpoints.

 * `get_dpird_extremes()`, which returns the recorded extreme values for the given station in the DPIRD weather station network.;
 * `get_dpird_minute()`, which returns weather data in minute increments for stations in the DPIRD weather station network with only the past two years being available; and
 * `get_dpird_summaries()`, which returns weather data in 15 and 30 minute, hourly, daily, monthly or yearly summary values for stations in the DPIRD weather station network.

## A Note on API Keys

All examples in this vignette assume that you have stored your API key in your .Renviron file.
See [Chapter 8](https://rstats.wtf/r-startup.html#renviron) in "What They Forgot to Teach You About R" by Bryan _et al._ for more on storing details in your .Renviron if you are unfamiliar.

## Getting Extreme Weather Values

The `get_dpird_extremes()` function fetches and returns nicely formatted individual extreme weather summaries from the DPIRD Weather 2.0 API.
You must provide a `station_code` and `API_key`, the other arguments, `values` and `include_closed` are optional.

### Available Values for Extreme Weather

 * all (which will return all of the following values),
 * erosionCondition,
 * erosionConditionLast7Days,
 * erosionConditionLast7DaysDays,
 * erosionConditionLast7DaysMinutes,
 * erosionConditionLast14Days,
 * erosionConditionLast14DaysDays,
 * erosionConditionLast14DaysMinutes,
 * erosionConditionMonthToDate,
 * erosionConditionMonthToDateDays,
 * erosionConditionMonthToDateMinutes,
 * erosionConditionMonthToDateStartTime,
 * erosionConditionSince12AM,
 * erosionConditionSince12AMMinutes,
 * erosionConditionSince12AMStartTime,
 * erosionConditionYearToDate,
 * erosionConditionYearToDateDays,
 * erosionConditionYearToDateMinutes,
 * erosionConditionYearToDateStartTime,
 * frostCondition,
 * frostConditionLast7Days,
 * frostConditionLast7DaysDays,
 * frostConditionLast7DaysMinutes,
 * frostConditionLast14Days,
 * frostConditionLast14DaysDays,
 * frostConditionLast14DaysMinutes,
 * frostConditionMonthToDate,
 * frostConditionMonthToDateDays,
 * frostConditionMonthToDateMinutes,
 * frostConditionMonthToDateStartTime,
 * frostConditionSince9AM,
 * frostConditionSince9AMMinutes,
 * frostConditionSince9AMStartTime,
 * frostConditionTo9AM,
 * frostConditionTo9AMMinutes,
 * frostConditionTo9AMStartTime,
 * frostConditionYearToDate,
 * frostConditionYearToDate,
 * frostConditionYearToDateMinutes,
 * frostConditionYearToDateStartTime,
 * heatCondition,
 * heatConditionLast7Days,
 * heatConditionLast7DaysDays,
 * heatConditionLast7DaysMinutes,
 * heatConditionLast14Days,
 * heatConditionLast14DaysDays,
 * heatConditionLast14DaysMinutes,
 * heatConditionMonthToDate,
 * heatConditionMonthToDateDays,
 * heatConditionMonthToDateMinutes,
 * heatConditionMonthToDateStartTime,
 * heatConditionSince12AM,
 * heatConditionSince12AMMinutes,
 * heatConditionSince12AMStartTime,
 * heatConditionYearToDate,
 * heatConditionYearToDateDays,
 * heatConditionYearToDateMinutes, and
 * heatConditionYearToDateStartTime

### Example 1: Get All Extremes for Northam, WA

In the first example, we illustrate how to fetch all extreme values available for Northam.


```r
library(weatherOz)

(extremes <- get_dpird_extremes(
  station_code = "NO",
  api_key = Sys.getenv("DPIRD_API_KEY")
))
```

### Example 2: Get Selected Extremes for Northam, WA

Fetch only soil erosion extreme conditions for Northam, WA.
The documentation for `get_dpird_extremes()` contains a full listing of the values that are available to query from this API endpoint.


```r
library(weatherOz)

(
  extremes <- get_dpird_extremes(
    station_code = "NO",
    values = "erosionCondition",
    api_key = Sys.getenv("DPIRD_API_KEY")
  )
)
```

## Getting Minute Data

This function fetches nicely formatted minute weather station data from the DPIRD Weather 2.0 API for a maximum 24-hour period.
You must provide a `station_code` and `API_key`, the other arguments, `start_date_time`, `minutes` and `values` are optional.

### Available Values for Minute Data

   * all (which will return all of the following values),
   * airTemperature,
   * dateTime,
   * dewPoint,
   * rainfall,
   * relativeHumidity,
   * soilTemperature,
   * solarIrradiance,
   * wetBulb,
   * wind,
   * windAvgSpeed,
   * windMaxSpeed, and
   * windMinSpeed

### Example 3: Get All Minute Data for the Past 24 Hours


```r
library(weatherOz)

(
  min_dat <- get_dpird_minute(
    station_code = "NO",
    api_key = Sys.getenv("DPIRD_API_KEY")
  )
)
#>       station_code           date_time air_temperature relative_humidity
#>    1:           NO 2023-07-26 10:45:00            13.4              75.5
#>    2:           NO 2023-07-26 10:46:00            13.4              76.2
#>    3:           NO 2023-07-26 10:47:00            13.4              75.8
#>    4:           NO 2023-07-26 10:48:00            13.5              76.2
#>    5:           NO 2023-07-26 10:49:00            13.5              76.3
#>   ---                                                                   
#> 1427:           NO 2023-07-27 10:31:00            13.8              73.7
#> 1428:           NO 2023-07-27 10:32:00            13.7              73.7
#> 1429:           NO 2023-07-27 10:33:00            13.7              73.2
#> 1430:           NO 2023-07-27 10:34:00            13.7              73.5
#> 1431:           NO 2023-07-27 10:35:00            13.9              74.2
#>       soil_temperature solar_irradiance rainfall dew_point wet_bulb wind_height
#>    1:             11.1              384        0       9.2     11.4           3
#>    2:             11.2              431        0       9.3     11.4           3
#>    3:             11.2              443        0       9.2     11.4           3
#>    4:             11.2              418        0       9.4     11.5           3
#>    5:             11.3              302        0       9.4     11.5           3
#>   ---                                                                          
#> 1427:             11.1              237        0       9.2     11.6           3
#> 1428:             11.1              487        0       9.1     11.5           3
#> 1429:             11.2              376        0       9.0     11.5           3
#> 1430:             11.2              648        0       9.1     11.5           3
#> 1431:             11.2              658        0       9.4     11.7           3
#>       wind_avg_speed wind_avg_direction_compass_point wind_avg_direction_degrees
#>    1:           8.10                               NW                        310
#>    2:           8.53                               NW                        326
#>    3:           6.84                               NW                        322
#>    4:           6.01                              WNW                        301
#>    5:           6.34                               NW                        314
#>   ---                                                                           
#> 1427:           2.95                              SSW                        206
#> 1428:           2.99                              SSW                        213
#> 1429:           4.18                               SW                        234
#> 1430:           3.38                               SW                        228
#> 1431:           1.58                               SW                        231
#>       wind_min_speed wind_max_speed
#>    1:          4.176          14.22
#>    2:          4.176          16.74
#>    3:          1.656          14.22
#>    4:          1.656           9.22
#>    5:          4.176          11.74
#>   ---                              
#> 1427:          1.656           4.18
#> 1428:          1.656           6.70
#> 1429:          1.656           6.70
#> 1430:          1.656           6.70
#> 1431:          0.000           4.18
```

### Example 4: Get Specific Time and Date Data for Specific Values

If you wish to supply a specific start date and time and values, you may do so as shown here.


```r
library(weatherOz)

(
  min_dat_t_rad_wind <- get_dpird_minute(
    station_code = "NO",
    start_date_time = "2023-02-01 13:00:00",
    minutes = 1440,
    values = c("airTemperature",
               "solarIrradiance",
               "wind"),
    api_key = Sys.getenv("DPIRD_API_KEY")
  )
)
#>       station_code           date_time air_temperature solar_irradiance wind_height
#>    1:           NO 2023-02-01 13:00:00            29.7             1087           3
#>    2:           NO 2023-02-01 13:00:50            29.4             1086           3
#>    3:           NO 2023-02-01 13:01:40            29.5             1084           3
#>    4:           NO 2023-02-01 13:02:30            29.5             1084           3
#>    5:           NO 2023-02-01 13:03:20            29.6             1084           3
#>   ---                                                                              
#> 1436:           NO 2023-02-02 12:55:00            30.2             1105           3
#> 1437:           NO 2023-02-02 12:55:50            30.1             1104           3
#> 1438:           NO 2023-02-02 12:56:40            30.0             1102           3
#> 1439:           NO 2023-02-02 12:57:30            29.9             1102           3
#> 1440:           NO 2023-02-02 12:58:20            30.1             1104           3
#>       wind_avg_speed wind_avg_direction_compass_point wind_avg_direction_degrees
#>    1:          11.66                               SE                        139
#>    2:          10.80                               SE                        136
#>    3:          11.81                              SSE                        156
#>    4:          12.71                               SE                        133
#>    5:          12.96                               SE                        139
#>   ---                                                                           
#> 1436:           9.54                              ESE                        112
#> 1437:           9.90                              ESE                        120
#> 1438:          13.03                              ESE                        121
#> 1439:          10.91                                E                         93
#> 1440:          10.40                                E                         97
#>       wind_min_speed wind_max_speed
#>    1:          4.176          26.82
#>    2:          4.176          19.26
#>    3:          6.696          19.26
#>    4:          6.696          26.82
#>    5:          6.696          19.26
#>   ---                              
#> 1436:          4.176          16.74
#> 1437:          4.176          19.26
#> 1438:          4.176          24.30
#> 1439:          6.696          21.78
#> 1440:          4.176          16.74
```

## Getting Summary Data

The function, `get_dpird_summary(), fetches nicely formatted minute weather station data from the DPIRD Weather 2.0 API for a maximum 24-hour period.
You must provide a `station_code` and `API_key`, the other arguments, `start_date_time`, `minutes` and `values` are optional.

### Available Values for Summary Data

   * all (which will return all of the following values),
   * airTemperature,
   * airTemperatureAvg,
   * airTemperatureMax,
   * airTemperatureMaxTime,
   * airTemperatureMin,
   * airTemperatureMinTime,
   * apparentAirTemperature,
   * apparentAirTemperatureAvg,
   * apparentAirTemperatureMax,
   * apparentAirTemperatureMaxTime,
   * apparentAirTemperatureMin,
   * apparentAirTemperatureMinTime,
   * barometricPressure,
   * barometricPressureAvg,
   * barometricPressureMax,
   * barometricPressureMaxTime,
   * barometricPressureMin,
   * barometricPressureMinTime,
   * battery,
   * batteryMinVoltage,
   * batteryMinVoltageDateTime,
   * chillHours,
   * deltaT,
   * deltaTAvg,
   * deltaTMax,
   * deltaTMaxTime,
   * deltaTMin,
   * deltaTMinTime,
   * dewPoint,
   * dewPointAvg,
   * dewPointMax,
   * dewPointMaxTime,
   * dewPointMin,
   * dewPointMinTime,
   * erosionCondition,
   * erosionConditionMinutes,
   * erosionConditionStartTime,
   * errors,
   * etoShortCrop,
   * etoTallCrop,
   * evapotranspiration,
   * frostCondition,
   * frostConditionMinutes,
   * frostConditionStartTime,
   * heatCondition,
   * heatConditionMinutes,
   * heatConditionStartTime,
   * observations,
   * observationsCount,
   * observationsPercentage,
   * panEvaporation,
   * rainfall,
   * relativeHumidity,
   * relativeHumidityAvg,
   * relativeHumidityMax,
   * relativeHumidityMaxTime,
   * relativeHumidityMin,
   * relativeHumidityMinTime,
   * richardsonUnits,
   * soilTemperature,
   * soilTemperatureAvg,
   * soilTemperatureMax,
   * soilTemperatureMaxTime,
   * soilTemperatureMin,
   * soilTemperatureMinTime,
   * solarExposure,
   * wetBulb,
   * wetBulbAvg,
   * wetBulbMax,
   * wetBulbMaxTime,
   * wetBulbMin,
   * wetBulbMinTime,
   * wind,
   * windAvgSpeed, and
   * windMaxSpeed

### What You Get Back

This function returns a [data.table::data.table] with `station_code` and the date interval queried together with the requested weather variables in alphabetical order.  Please note this function converts date-time columns from Coordinated Universal Time 'UTC'} to Australian Western Standard Time 'AWST'.  The first ten columns will always be:

   * `station_code`,
   * `station_name`,
   * `latitude`,
   * `longitude`,
   * `year`,
   * `month`,
   * `day`,
   * `hour`,
   * `minute`, and if `month` or finer is present,
   * `date` (a combination of year, month, day, hour, minute as appropriate)

### Example 5: Get Annual Rainfall Since 2017

Use the default value for end date (current system date) to get annual rainfall since 2017 until current year for Capel.


```r
library(weatherOz)

(
  annual_rain <- get_dpird_summaries(
    station_code = "CL001",
    start_date = "20170101",
    api_key = Sys.getenv("DPIRD_API_KEY"),
    interval = "yearly",
    values = "rainfall"
  )
)
#>    station_code station_name year rainfall
#> 1:        CL001        Capel 2017    711.4
#> 2:        CL001        Capel 2018    822.0
#> 3:        CL001        Capel 2019    660.6
#> 4:        CL001        Capel 2020    862.4
#> 5:        CL001        Capel 2021    928.0
#> 6:        CL001        Capel 2022    670.4
#> 7:        CL001        Capel 2023    383.2
```

### Example 6: Get Monthly Rainfall Since 2017

Use the default value for end date (current system date) to get monthly rainfall since 2017 until current year for Capel.


```r
library(weatherOz)

(
  monthly_rain <- get_dpird_summaries(
    station_code = "CL001",
    start_date = "20170101",
    api_key = Sys.getenv("DPIRD_API_KEY"),
    interval = "monthly",
    values = "rainfall"
  )
)
#>     station_code station_name year month       date rainfall
#>  1:        CL001        Capel 2017     1 2017-01-01      0.0
#>  2:        CL001        Capel 2017     2 2017-02-01      0.0
#>  3:        CL001        Capel 2017     3 2017-03-01     59.6
#>  4:        CL001        Capel 2017     4 2017-04-01      0.0
#>  5:        CL001        Capel 2017     5 2017-05-01     84.0
#>  6:        CL001        Capel 2017     6 2017-06-01     57.8
#>  7:        CL001        Capel 2017     7 2017-07-01    194.4
#>  8:        CL001        Capel 2017     8 2017-08-01    175.8
#>  9:        CL001        Capel 2017     9 2017-09-01     49.8
#> 10:        CL001        Capel 2017    10 2017-10-01     34.0
#> 11:        CL001        Capel 2017    11 2017-11-01     14.2
#> 12:        CL001        Capel 2017    12 2017-12-01     41.8
#> 13:        CL001        Capel 2018     1 2018-01-01     14.4
#> 14:        CL001        Capel 2018     2 2018-02-01      0.2
#> 15:        CL001        Capel 2018     3 2018-03-01     15.4
#> 16:        CL001        Capel 2018     4 2018-04-01     42.8
#> 17:        CL001        Capel 2018     5 2018-05-01    115.2
#> 18:        CL001        Capel 2018     6 2018-06-01    168.8
#> 19:        CL001        Capel 2018     7 2018-07-01    214.6
#> 20:        CL001        Capel 2018     8 2018-08-01    156.8
#> 21:        CL001        Capel 2018     9 2018-09-01     29.6
#> 22:        CL001        Capel 2018    10 2018-10-01     45.8
#> 23:        CL001        Capel 2018    11 2018-11-01     11.2
#> 24:        CL001        Capel 2018    12 2018-12-01      7.2
#> 25:        CL001        Capel 2019     1 2019-01-01      6.0
#> 26:        CL001        Capel 2019     2 2019-02-01      0.0
#> 27:        CL001        Capel 2019     3 2019-03-01     29.4
#> 28:        CL001        Capel 2019     4 2019-04-01     33.0
#> 29:        CL001        Capel 2019     5 2019-05-01     27.0
#> 30:        CL001        Capel 2019     6 2019-06-01    239.6
#> 31:        CL001        Capel 2019     7 2019-07-01     85.4
#> 32:        CL001        Capel 2019     8 2019-08-01    117.8
#> 33:        CL001        Capel 2019     9 2019-09-01     45.8
#> 34:        CL001        Capel 2019    10 2019-10-01     67.0
#> 35:        CL001        Capel 2019    11 2019-11-01      7.8
#> 36:        CL001        Capel 2019    12 2019-12-01      1.8
#> 37:        CL001        Capel 2020     1 2020-01-01      2.0
#> 38:        CL001        Capel 2020     2 2020-02-01     31.8
#> 39:        CL001        Capel 2020     3 2020-03-01     40.8
#> 40:        CL001        Capel 2020     4 2020-04-01     41.6
#> 41:        CL001        Capel 2020     5 2020-05-01    156.2
#> 42:        CL001        Capel 2020     6 2020-06-01    132.4
#> 43:        CL001        Capel 2020     7 2020-07-01    125.8
#> 44:        CL001        Capel 2020     8 2020-08-01     96.0
#> 45:        CL001        Capel 2020     9 2020-09-01    110.0
#> 46:        CL001        Capel 2020    10 2020-10-01     32.6
#> 47:        CL001        Capel 2020    11 2020-11-01     88.0
#> 48:        CL001        Capel 2020    12 2020-12-01      5.2
#> 49:        CL001        Capel 2021     1 2021-01-01      0.0
#> 50:        CL001        Capel 2021     2 2021-02-01     76.2
#> 51:        CL001        Capel 2021     3 2021-03-01     27.4
#> 52:        CL001        Capel 2021     4 2021-04-01     92.0
#> 53:        CL001        Capel 2021     5 2021-05-01    160.6
#> 54:        CL001        Capel 2021     6 2021-06-01     81.2
#> 55:        CL001        Capel 2021     7 2021-07-01    187.6
#> 56:        CL001        Capel 2021     8 2021-08-01     90.4
#> 57:        CL001        Capel 2021     9 2021-09-01     93.4
#> 58:        CL001        Capel 2021    10 2021-10-01    109.4
#> 59:        CL001        Capel 2021    11 2021-11-01      5.4
#> 60:        CL001        Capel 2021    12 2021-12-01      4.4
#> 61:        CL001        Capel 2022     1 2022-01-01      0.0
#> 62:        CL001        Capel 2022     2 2022-02-01      4.4
#> 63:        CL001        Capel 2022     3 2022-03-01      4.6
#> 64:        CL001        Capel 2022     4 2022-04-01     44.0
#> 65:        CL001        Capel 2022     5 2022-05-01    105.6
#> 66:        CL001        Capel 2022     6 2022-06-01    103.8
#> 67:        CL001        Capel 2022     7 2022-07-01    169.0
#> 68:        CL001        Capel 2022     8 2022-08-01    121.4
#> 69:        CL001        Capel 2022     9 2022-09-01     69.4
#> 70:        CL001        Capel 2022    10 2022-10-01     29.0
#> 71:        CL001        Capel 2022    11 2022-11-01     18.0
#> 72:        CL001        Capel 2022    12 2022-12-01      1.2
#> 73:        CL001        Capel 2023     1 2023-01-01      0.8
#> 74:        CL001        Capel 2023     2 2023-02-01      0.0
#> 75:        CL001        Capel 2023     3 2023-03-01     27.8
#> 76:        CL001        Capel 2023     4 2023-04-01     81.2
#> 77:        CL001        Capel 2023     5 2023-05-01     31.8
#> 78:        CL001        Capel 2023     6 2023-06-01    130.0
#> 79:        CL001        Capel 2023     7 2023-07-01    111.6
#>     station_code station_name year month       date rainfall
```

### Example 7: Get Daily Rainfall and Wind From Beginning of 2017 to End of 2018

Use the default value for end date (current system date) to get daily rainfall and wind records from 2017-01-01 to 2018-12-31 for Binnu.
Note that the Binnu station has two wind heights, 3m and 10m.


```r
library(weatherOz)

(
  daily_wind_rain <- get_dpird_summaries(
    station_code = "BI",
    start_date = "20170101",
    end_date = "2018-12-31",
    api_key = Sys.getenv("DPIRD_API_KEY"),
    interval = "daily",
    values = c("rainfall",
               "wind")
  )
)
#>       station_code station_name year month day       date rainfall wind_avg_speed
#>    1:           BI        Binnu 2017     1   1 2017-01-01        0           4.28
#>    2:           BI        Binnu 2017     1   1 2017-01-01        0           6.85
#>    3:           BI        Binnu 2017     1   2 2017-01-02        0           4.53
#>    4:           BI        Binnu 2017     1   2 2017-01-02        0           7.39
#>    5:           BI        Binnu 2017     1   3 2017-01-03        0           4.74
#>   ---                                                                            
#> 1456:           BI        Binnu 2018    12  29 2018-12-29        0          35.63
#> 1457:           BI        Binnu 2018    12  30 2018-12-30        0          29.19
#> 1458:           BI        Binnu 2018    12  30 2018-12-30        0          36.70
#> 1459:           BI        Binnu 2018    12  31 2018-12-31        0          32.52
#> 1460:           BI        Binnu 2018    12  31 2018-12-31        0          41.51
#>       wind_height wind_max_direction_compass_point wind_max_direction_degrees
#>    1:           3                              NNE                         31
#>    2:          10                              ESE                        121
#>    3:           3                               NE                         41
#>    4:          10                                N                          1
#>    5:           3                              WSW                        247
#>   ---                                                                        
#> 1456:          10                               SE                        134
#> 1457:           3                              ESE                        105
#> 1458:          10                              ESE                        113
#> 1459:           3                              SSE                        163
#> 1460:          10                              SSE                        167
#>       wind_max_speed       wind_max_time
#>    1:          17.57 2018-07-17 11:51:00
#>    2:          23.18 2017-07-30 11:38:00
#>    3:          21.78 2017-08-10 13:29:00
#>    4:          19.55 2018-07-17 12:16:00
#>    5:          18.40 2017-06-14 09:05:00
#>   ---                                   
#> 1456:          60.91 2017-02-09 15:56:00
#> 1457:          62.03 2018-01-14 22:55:00
#> 1458:          69.77 2018-01-14 22:45:00
#> 1459:          58.64 2017-02-08 09:12:00
#> 1460:          64.40 2017-02-08 04:48:00
```

### Example 8: Get Hourly Rainfall and Wind From Beginning of 2022 to Current

Use the default value for end date (current system date) to get hourly rainfall and wind records from 2022-01-01 to Current Date for Binnu.
Note that the Binnu station has two wind heights, 3m and 10m.


```r
library(weatherOz)

(
  hourly_wind_rain <- get_dpird_summaries(
    station_code = "BI",
    start_date = "20220101",
    api_key = Sys.getenv("DPIRD_API_KEY"),
    interval = "hourly",
    values = c("rainfall",
               "wind")
  )
)
#>       station_code station_name year month day hour                date rainfall
#>    1:           BI        Binnu 2023     6  26   16 2023-06-26 16:00:00        0
#>    2:           BI        Binnu 2023     6  26   16 2023-06-26 16:00:00        0
#>    3:           BI        Binnu 2023     6  26   17 2023-06-26 17:00:00        0
#>    4:           BI        Binnu 2023     6  26   17 2023-06-26 17:00:00        0
#>    5:           BI        Binnu 2023     6  26   18 2023-06-26 18:00:00        0
#>   ---                                                                           
#> 1454:           BI        Binnu 2023     7  26   22 2023-07-26 22:00:00        0
#> 1455:           BI        Binnu 2023     7  26   23 2023-07-26 23:00:00        0
#> 1456:           BI        Binnu 2023     7  26   23 2023-07-26 23:00:00        0
#> 1457:           BI        Binnu 2023     7  27    0 2023-07-27 00:00:00        0
#> 1458:           BI        Binnu 2023     7  27    0 2023-07-27 00:00:00        0
#>       wind_avg_direction_compass_point wind_avg_direction_degrees wind_avg_speed
#>    1:                               SE                        129           0.75
#>    2:                                W                        274           1.80
#>    3:                                W                        271           1.23
#>    4:                              ESE                        114           2.80
#>    5:                              ENE                         61           1.34
#>   ---                                                                           
#> 1454:                               SW                        222          36.62
#> 1455:                               SW                        225          32.09
#> 1456:                               SW                        226          39.90
#> 1457:                               SW                        227          32.79
#> 1458:                               SW                        227          39.94
#>       wind_height wind_max_direction_compass_point wind_max_direction_degrees
#>    1:           3                              ESE                        123
#>    2:          10                              SSW                        204
#>    3:           3                              WSW                        252
#>    4:          10                               SE                        145
#>    5:           3                              ENE                         61
#>   ---                                                                        
#> 1454:          10                               SW                        216
#> 1455:           3                               SW                        221
#> 1456:          10                               SW                        226
#> 1457:           3                               SW                        227
#> 1458:          10                               SW                        234
#>       wind_max_speed       wind_max_time
#>    1:           4.14 2023-07-06 06:44:00
#>    2:           4.36 2023-07-02 21:01:00
#>    3:           5.80 2023-07-02 19:42:00
#>    4:           4.79 2023-07-07 05:14:00
#>    5:           4.14 2023-07-06 00:02:00
#>   ---                                   
#> 1454:          50.83 2023-07-19 11:07:00
#> 1455:          45.25 2023-07-19 09:37:00
#> 1456:          53.28 2023-07-19 09:38:00
#> 1457:          50.29 2023-07-19 10:16:00
#> 1458:          50.54 2023-07-19 10:49:00
```

## Getting APSIM Ready Data

For work with APSIM, you can use `get_dpird_apsim()` to get an object in your R session that's ready for saving using [apsimx::write_apsim_met()] of DPIRD weather data.
This function only needs the `station_code`, `start_date`, `end_date` and your `api_key` to return the necessary values.

### What You Get Back

An object of [apsimx] 'met' class, compatible with a `data.frame`, that has daily data that include year, day, radation, max temperature, min temperature, rainfall, relative humidity and windspeed.

### Example 9: Get APSIM Formatted Data for Binnu From 2022-04-01 to 2022-11-01


```r
library(weatherOz)

(
  binnu <- get_dpird_apsim(
    station_code = "BI",
    start_date = "20220401",
    end_date = "20221101",
    api_key = Sys.getenv("DPIRD_API_KEY")
  )
)
#> Error: You have specified invalid weather values.
```

## Working With DPIRD Metadata

Three functions are provided to assist in fetching metadata about the stations.
 * `find_nearby_stations()`, which returns a `data.table` with the nearest weather stations to a given geographic point or known station either in the DPIRD or BOM (from SILO) networks.
 * `get_dpird_availability()`, which returns a `data.table` with the availability for weather stations in the DPIRD network providing the up time and data availability for a given period of time.
 * `get_station_metadata()`, which returns a `data.table` with the latest and most up-to-date information available from the Weather 2.0 API on the stations' geographic locations, hardware details, *e.g.,* wind mast height, and recording capabilities.

### Finding Nearby Stations

### Example 10: Finding Stations Nearby a Known Station

Query WA only stations and return DPIRD's stations nearest to the Northam, WA station, "NO", returning stations with 50 km of this station.


```r
library(weatherOz)

(
  wa_stn <- find_nearby_stations(
    station_code = "NO",
    distance_km = 50,
    api_key = Sys.getenv("DPIRD_API_KEY"),
    which_api = "dpird"
  )
)
#>    station_code       station_name longitude  latitude state elev_m
#> 1:           NO            Northam  116.6942 -31.65161    WA    163
#> 2:           MK             Muresk  116.6913 -31.72772    WA    251
#> 3:        YE001          York East  116.9211 -31.83588    WA    229
#> 4:         BTSB DFES-B Talbot West  116.6898 -31.96060    WA    358
#> 5:         ROGR      Rolling Green  116.3184 -31.69527    WA    315
#>                                                                   owner distance_km
#> 1: WA Department of Primary Industries and Regional Development (DPIRD)        0.00
#> 2: WA Department of Primary Industries and Regional Development (DPIRD)        7.62
#> 3: WA Department of Primary Industries and Regional Development (DPIRD)       29.23
#> 4:                  WA Department of Fire and Emergency Services (DFES)       30.90
#> 5:   WA Department of Biodiversity, Conservation and Attractions (DBCA)       37.83
```

### Example 11: Finding Stations Nearby a Given Longitude and Latitude

Using the longitude and latitude for Northam, WA, find all DPIRD stations within a 50km radius of this geographic point.


```r
library(weatherOz)

(
  wa_stn_lonlat <- find_nearby_stations(
    longitude = 116.6620,
    latitude = -31.6540,
    distance_km = 50,
    api_key = Sys.getenv("DPIRD_API_KEY"),
    which_api = "dpird"
  )
)
#>    station_code       station_name longitude  latitude state elev_m
#> 1:           NO            Northam  116.6942 -31.65161    WA    163
#> 2:           MK             Muresk  116.6913 -31.72772    WA    251
#> 3:         BTSB DFES-B Talbot West  116.6898 -31.96060    WA    358
#> 4:        YE001          York East  116.9211 -31.83588    WA    229
#> 5:         ROGR      Rolling Green  116.3184 -31.69527    WA    315
#>                                                                   owner distance_km
#> 1: WA Department of Primary Industries and Regional Development (DPIRD)        3.23
#> 2: WA Department of Primary Industries and Regional Development (DPIRD)        7.93
#> 3:                  WA Department of Fire and Emergency Services (DFES)       30.79
#> 4: WA Department of Primary Industries and Regional Development (DPIRD)       31.65
#> 5:   WA Department of Biodiversity, Conservation and Attractions (DBCA)       34.61
```

### Example 12: Finding Stations in Both the DPIRD and SILO Data Sets

Query stations nearest DPIRD's Northam, WA station, "NO" and return both DPIRD and SILO/BOM stations within 50 km of this station.


```r
library(weatherOz)

(
  wa_stn_all <- find_nearby_stations(
    station_code = "NO",
    distance_km = 50,
    api_key = Sys.getenv("DPIRD_API_KEY"),
    which_api = "all"
  )
)
#>     station_code       station_name longitude  latitude state elev_m
#>  1:           NO            Northam  116.6942 -31.65161    WA  163.0
#>  2:       010111            Northam  116.6586 -31.65080    WA  170.0
#>  3:           MK             Muresk  116.6913 -31.72772    WA  251.0
#>  4:       010150       Grass Valley  116.7969 -31.63580    WA  200.0
#>  5:       010152   Muresk Institute  116.6833 -31.75000    WA  166.0
#>  6:       010066        Jennapullin  116.7000 -31.51670    WA  186.7
#>  7:       010027             Eadine  116.5167 -31.71670    WA  231.0
#>  8:       010115        Quellington  116.8647 -31.77140    WA  220.0
#>  9:       010166        Southbourne  116.4928 -31.73810    WA  280.0
#> 10:       010008         Berry Brow  116.5333 -31.81670    WA  327.2
#> 11:       010125            Toodyay  116.4703 -31.55170    WA  140.0
#> 12:       010244        Bakers Hill  116.4561 -31.74690    WA  330.0
#> 13:       010144   York Post Office  116.7581 -31.88360    WA  174.0
#> 14:       010063        Hawthornden  116.4583 -31.51360    WA  160.0
#> 15:       010311               York  116.7650 -31.89970    WA  179.0
#> 16:       010023     Warradong Farm  116.9411 -31.50030    WA  240.0
#> 17:        YE001          York East  116.9211 -31.83588    WA  229.0
#> 18:       010091          Meckering  117.0081 -31.63220    WA  195.0
#> 19:         BTSB DFES-B Talbot West  116.6898 -31.96060    WA  358.0
#> 20:       010056             Inkpen  116.4169 -31.80420    WA  310.0
#> 21:         ROGR      Rolling Green  116.3184 -31.69527    WA  315.0
#> 22:       010138           Wooroloo  116.3413 -31.81500    WA  277.0
#> 23:       010020          Wanobbing  116.9667 -31.91670    WA  228.7
#> 24:       010069           Jurokine  116.6000 -31.30000    WA  264.4
#> 25:       010058         Goomalling  116.8269 -31.29940    WA  239.0
#> 26:       010134          Wattening  116.5150 -31.31190    WA  240.0
#> 27:       010165        Green Hills  116.9839 -31.94080    WA  244.0
#> 28:       010163             Jaroma  117.1433 -31.77060    WA  265.0
#> 29:       010009            Bolgart  116.5092 -31.27440    WA  240.0
#> 30:       010160        Quella Park  117.1194 -31.45330    WA  265.0
#> 31:       009007            Chidlow  116.2658 -31.86220    WA  300.0
#> 32:       009133 Lake Leschenaultia  116.2539 -31.85110    WA  260.0
#> 33:       010120       Doodenanning  117.0986 -31.90920    WA  290.0
#> 34:       009066        Gidgegannup  116.1976 -31.79060    WA  290.0
#> 35:       010062           Ely Park  116.8819 -31.23470    WA  300.0
#>     station_code       station_name longitude  latitude state elev_m
#>                                                                    owner distance_km
#>  1: WA Department of Primary Industries and Regional Development (DPIRD)    0.000000
#>  2:                                                                  BOM    3.369959
#>  3: WA Department of Primary Industries and Regional Development (DPIRD)    7.620000
#>  4:                                                                  BOM    9.878912
#>  5:                                                                  BOM   10.986728
#>  6:                                                                  BOM   15.008666
#>  7:                                                                  BOM   18.285490
#>  8:                                                                  BOM   20.914807
#>  9:                                                                  BOM   21.340647
#> 10:                                                                  BOM   23.839476
#> 11:                                                                  BOM   23.934879
#> 12:                                                                  BOM   24.889495
#> 13:                                                                  BOM   26.489107
#> 14:                                                                  BOM   27.103418
#> 15:                                                                  BOM   28.381350
#> 16:                                                                  BOM   28.808439
#> 17: WA Department of Primary Industries and Regional Development (DPIRD)   29.230000
#> 18:                                                                  BOM   29.790490
#> 19:                  WA Department of Fire and Emergency Services (DFES)   30.900000
#> 20:                                                                  BOM   31.231276
#> 21:   WA Department of Biodiversity, Conservation and Attractions (DBCA)   37.830000
#> 22:                                                                  BOM   37.993263
#> 23:                                                                  BOM   39.138323
#> 24:                                                                  BOM   40.097391
#> 25:                                                                  BOM   41.128932
#> 26:                                                                  BOM   41.412805
#> 27:                                                                  BOM   42.226585
#> 28:                                                                  BOM   44.489821
#> 29:                                                                  BOM   45.457855
#> 30:                                                                  BOM   45.923973
#> 31:                                                                  BOM   46.778842
#> 32:                                                                  BOM   47.165604
#> 33:                                                                  BOM   47.759247
#> 34:                                                                  BOM   49.440793
#> 35:                                                                  BOM   49.651776
#>                                                                    owner distance_km
```

### Checking Station Uptime or Availability

### Example 13: Checking Station Availability for Current Year

Check the availability of the Westonia station since the start of the current year using the default functionality with no `start_date` or `end_date`.


```r
library(weatherOz)

(WS001 <- get_dpird_availability(
  station_code = "WS001",
  api_key = Sys.getenv("DPIRD_API_KEY")
))
#>    station_code station_name to9_am since9_am since12_am current_hour last24_hours
#> 1:        WS001     Westonia    100       100        100          100          100
#>    last7_days_since9_am last7_days_since12_am last14_days_since9_am
#> 1:                  100                   100                   100
#>    last14_days_since12_am month_to_date_to9_am month_to_date_since12_am
#> 1:                    100                  100                      100
#>    year_to_date_to9_am year_to_date_since12_am
#> 1:                 100                     100
```

### Example 14: Checking Station Availability for a Set Time Period

Check the availability of the Binnu station for January of 2018.
When a custom `start_date` is provided an `end_date` must also be provided.


```r
library(weatherOz)

(
  BI_201801 <- get_dpird_availability(
    station_code = "BI",
    start_date = "2018-01-01",
    end_date = "2018-01-31",
    api_key = Sys.getenv("DPIRD_API_KEY")
  )
)
#>    station_code station_name start_date   end_date availability_since_9_am
#> 1:           BI        Binnu 2018-01-01 2018-01-31                     100
#>    availability_since_12_am
#> 1:                      100
```

### Getting Station Metadata for the DPIRD Network Stations

The `get_station_metadata()` function is shared with the SILO functions as well, so this function will retrieve data from both weather APIs.
Shown here is how to use it for DPIRD data only and with an example of DPIRD specific information, namely including closed stations and rich metadata.

### Example 15: Get DPIRD Station Metadata

The `get_station_metadata()` function allows you to get details about the stations themselves for stations in the DPIRD and SILO (BOM) networks in one function.
Here we demonstrate how to get the metadata for the DPIRD stations only.


```r
library(weatherOz)

(metadata <- get_station_metadata(which_api = "dpird",
                                  api_key = Sys.getenv("DPIRD_API_KEY")))
#>      station_code station_name      start        end  latitude longitude state
#>   1:        AN001    Allanooka 2012-06-19 2023-07-27 -29.06361  114.9972    WA
#>   2:        AM001       Amelup 2019-10-09 2023-07-27 -34.27083  118.2685    WA
#>   3:        SH002      Babakin 2016-06-22 2023-07-27 -32.12548  118.0041    WA
#>   4:           BA  Badgingarra 2008-11-19 2023-07-27 -30.33805  115.5395    WA
#>   5:        BP001     Balingup 2014-10-24 2023-07-27 -33.79620  116.0640    WA
#>  ---                                                                          
#> 225:           YS      Yilgarn 2008-11-01 2023-07-27 -31.91562  119.2561    WA
#> 226:        YE001    York East 2013-11-08 2023-07-27 -31.83588  116.9211    WA
#> 227:        YU001         Yuna 2012-06-21 2023-07-27 -28.33763  114.9898    WA
#> 228:        YU002      Yuna NE 2016-03-24 2023-07-27 -28.20032  115.2616    WA
#> 229:        YU003   Yuna North 2018-08-08 2023-07-27 -28.12086  114.9626    WA
#>      elev_m                                                               source
#>   1:    131 WA Department of Primary Industries and Regional Development (DPIRD)
#>   2:    200 WA Department of Primary Industries and Regional Development (DPIRD)
#>   3:    313 WA Department of Primary Industries and Regional Development (DPIRD)
#>   4:    284 WA Department of Primary Industries and Regional Development (DPIRD)
#>   5:    227 WA Department of Primary Industries and Regional Development (DPIRD)
#>  ---                                                                            
#> 225:    468 WA Department of Primary Industries and Regional Development (DPIRD)
#> 226:    229 WA Department of Primary Industries and Regional Development (DPIRD)
#> 227:    329 WA Department of Primary Industries and Regional Development (DPIRD)
#> 228:    267 WA Department of Primary Industries and Regional Development (DPIRD)
#> 229:    264 WA Department of Primary Industries and Regional Development (DPIRD)
#>      status wmo
#>   1:   open  NA
#>   2:   open  NA
#>   3:   open  NA
#>   4:   open  NA
#>   5:   open  NA
#>  ---           
#> 225:   open  NA
#> 226:   open  NA
#> 227:   open  NA
#> 228:   open  NA
#> 229:   open  NA
```

### Example 16: Get Rich DPIRD Station Metadata and Include Closed Stations

You can fetch additional information about the DPIRD stations as well as getting data for stations that are no longer open like so with the `rich` and `include_closed` arguments set to `TRUE`.


```r
library(weatherOz)

(metadata <- get_station_metadata(which_api = "dpird",
                                  include_closed = TRUE,
                                  rich = TRUE,
                                  api_key = Sys.getenv("DPIRD_API_KEY")))
#>      station_code station_name      start        end  latitude longitude state
#>   1:        AN001    Allanooka 2012-06-19 2023-07-27 -29.06361  114.9972    WA
#>   2:        AM001       Amelup 2019-10-09 2023-07-27 -34.27083  118.2685    WA
#>   3:        SH002      Babakin 2016-06-22 2023-07-27 -32.12548  118.0041    WA
#>   4:           BA  Badgingarra 2008-11-19 2023-07-27 -30.33805  115.5395    WA
#>   5:        BP001     Balingup 2014-10-24 2023-07-27 -33.79620  116.0640    WA
#>  ---                                                                          
#> 229:           YS      Yilgarn 2008-11-01 2023-07-27 -31.91562  119.2561    WA
#> 230:        YE001    York East 2013-11-08 2023-07-27 -31.83588  116.9211    WA
#> 231:        YU001         Yuna 2012-06-21 2023-07-27 -28.33763  114.9898    WA
#> 232:        YU002      Yuna NE 2016-03-24 2023-07-27 -28.20032  115.2616    WA
#> 233:        YU003   Yuna North 2018-08-08 2023-07-27 -28.12086  114.9626    WA
#>      elev_m                                                               source
#>   1:    131 WA Department of Primary Industries and Regional Development (DPIRD)
#>   2:    200 WA Department of Primary Industries and Regional Development (DPIRD)
#>   3:    313 WA Department of Primary Industries and Regional Development (DPIRD)
#>   4:    284 WA Department of Primary Industries and Regional Development (DPIRD)
#>   5:    227 WA Department of Primary Industries and Regional Development (DPIRD)
#>  ---                                                                            
#> 229:    468 WA Department of Primary Industries and Regional Development (DPIRD)
#> 230:    229 WA Department of Primary Industries and Regional Development (DPIRD)
#> 231:    329 WA Department of Primary Industries and Regional Development (DPIRD)
#> 232:    267 WA Department of Primary Industries and Regional Development (DPIRD)
#> 233:    264 WA Department of Primary Industries and Regional Development (DPIRD)
#>      status wmo probe_height rain_gauge_height wind_probe_heights air_temperature
#>   1:   open  NA         1.25               0.5                  3            TRUE
#>   2:   open  NA         1.25               1.0                  3            TRUE
#>   3:   open  NA         1.25               0.5                  3            TRUE
#>   4:   open  NA         1.25               0.5                  3            TRUE
#>   5:   open  NA         1.25               0.5                  3            TRUE
#>  ---                                                                             
#> 229:   open  NA         1.25               0.5                  3            TRUE
#> 230:   open  NA         1.25               0.5                  3            TRUE
#> 231:   open  NA         1.25               0.5                  3            TRUE
#> 232:   open  NA         1.25               0.5                  3            TRUE
#> 233:   open  NA         1.25               0.5                  3            TRUE
#>      battery_voltage delta_t dew_point pan_evaporation relative_humidity
#>   1:            TRUE    TRUE      TRUE            TRUE              TRUE
#>   2:            TRUE    TRUE      TRUE            TRUE              TRUE
#>   3:            TRUE    TRUE      TRUE            TRUE              TRUE
#>   4:            TRUE    TRUE      TRUE            TRUE              TRUE
#>   5:            TRUE    TRUE      TRUE            TRUE              TRUE
#>  ---                                                                    
#> 229:            TRUE    TRUE      TRUE            TRUE              TRUE
#> 230:            TRUE    TRUE      TRUE            TRUE              TRUE
#> 231:            TRUE    TRUE      TRUE            TRUE              TRUE
#> 232:            TRUE    TRUE      TRUE            TRUE              TRUE
#> 233:            TRUE    TRUE      TRUE            TRUE              TRUE
#>      barometric_pressure rainfall soil_temperature solar_irradiance wet_bulb wind1
#>   1:               FALSE     TRUE            FALSE             TRUE     TRUE  TRUE
#>   2:               FALSE     TRUE            FALSE             TRUE     TRUE  TRUE
#>   3:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#>   4:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#>   5:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#>  ---                                                                              
#> 229:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#> 230:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#> 231:               FALSE     TRUE            FALSE             TRUE     TRUE  TRUE
#> 232:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#> 233:               FALSE     TRUE             TRUE             TRUE     TRUE  TRUE
#>      wind2 wind3 apparent_temperature eto_short eto_tall frost_condition
#>   1: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>   2: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>   3: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>   4: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>   5: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>  ---                                                                    
#> 229: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#> 230: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#> 231: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#> 232: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#> 233: FALSE FALSE                 TRUE      TRUE     TRUE            TRUE
#>      heat_condition wind_erosion_condition richardson_unit chill_hour
#>   1:           TRUE                   TRUE            TRUE       TRUE
#>   2:           TRUE                   TRUE            TRUE       TRUE
#>   3:           TRUE                   TRUE            TRUE       TRUE
#>   4:           TRUE                   TRUE            TRUE       TRUE
#>   5:           TRUE                   TRUE            TRUE       TRUE
#>  ---                                                                 
#> 229:           TRUE                   TRUE            TRUE       TRUE
#> 230:           TRUE                   TRUE            TRUE       TRUE
#> 231:           TRUE                   TRUE            TRUE       TRUE
#> 232:           TRUE                   TRUE            TRUE       TRUE
#> 233:           TRUE                   TRUE            TRUE       TRUE
```
